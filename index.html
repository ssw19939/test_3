<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HG AI Agents - Zero Latency</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --app-bg-tarot: #e8f5e9; 
            --app-bg-saju: #fffdf5; 
            --text-panda: #673ab7; 
            --text-cat: #ff5252;
            --gemini-blue: #4285f4;
        }
        body { background-color: #f0f4f9; margin: 0; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; display: flex; justify-content: center; align-items: center; height: 100dvh; }
        .hidden { display: none !important; }
        
        /* ì•± ì»¨í…Œì´ë„ˆ */
        .app-container { width: 100%; max-width: 600px; height: 100dvh; display: flex; flex-direction: column; position: relative; background: #fff; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.1); }

        /* --- 1. ë¡œê·¸ì¸ í™”ë©´ --- */
        #login-screen { 
            position: absolute; inset: 0; z-index: 9999; 
            background: linear-gradient(180deg, #ffffff 0%, #f0f4f9 100%);
            display: flex; flex-direction: column; padding: 20px;
        }
        .gemini-header { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; padding-bottom: 60px; }
        .gemini-logo { font-size: 2.5rem; font-weight: 500; background: linear-gradient(90deg, #4285f4, #9b72cb, #d96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .gemini-greeting { font-size: 2rem; font-weight: 500; color: #c4c7c5; line-height: 1.3; }
        .gemini-greeting span { display: block; background: linear-gradient(90deg, #4b90ff, #ff5546); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .chat-input-area { background: #fff; border-radius: 30px; padding: 10px 20px; display: flex; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; margin-bottom: 20px; transition: all 0.3s; }
        .chat-input-area:focus-within { box-shadow: 0 4px 20px rgba(66, 133, 244, 0.2); border-color: #4285f4; }
        .chat-input { flex: 1; border: none; outline: none; font-size: 1rem; padding: 10px; color: #333; }
        .chat-submit-btn { background: none; border: none; cursor: pointer; color: #4285f4; font-size: 1.2rem; padding: 5px; transition: transform 0.2s; }
        .chat-submit-btn:hover { transform: scale(1.1); }
        .version-tag { position: absolute; top: 20px; right: 20px; font-size: 0.75rem; color: #aaa; font-weight: bold; }

        /* --- 2. ì„ íƒ í™”ë©´ --- */
        #selection-screen { position: absolute; inset: 0; background: #000; }
        .split-panel { position: absolute; top: 0; bottom: 0; width: 100%; height: 100%; transition: clip-path 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), filter 0.4s; cursor: pointer; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .panel-left { background: linear-gradient(135deg, #66bb6a 0%, #2e7d32 100%); clip-path: polygon(0 0, 60% 0, 40% 100%, 0 100%); z-index: 10; }
        .panel-right { background: linear-gradient(135deg, #fff8e1 0%, #ffe0b2 100%); clip-path: polygon(60% 0, 100% 0, 100% 100%, 40% 100%); z-index: 10; }
        .panel-left:hover { clip-path: polygon(0 0, 75% 0, 55% 100%, 0 100%); filter: brightness(1.1); z-index: 20; }
        .panel-right:hover { clip-path: polygon(45% 0, 100% 0, 100% 100%, 25% 100%); filter: brightness(1.05); z-index: 20; }
        
        .char-img { width: 200px; height: 200px; object-fit: contain; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3)); animation: float 3s infinite ease-in-out; transition: 0.3s; background-color: transparent; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .panel-left:hover .char-img { transform: scale(1.1) rotate(-5deg); } .panel-right:hover .char-img { transform: scale(1.1) rotate(5deg); }
        .title-badge { margin-top: 15px; padding: 8px 20px; border-radius: 12px; font-family: 'Black Han Sans', sans-serif; font-size: 2.5rem; background: rgba(255,255,255,0.95); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .panel-left .title-badge { color: var(--text-panda); border: 3px solid var(--text-panda); } .panel-right .title-badge { color: var(--text-cat); border: 3px solid var(--text-cat); }

        /* --- 3. ì•± ë‚´ë¶€ ê³µí†µ --- */
        .theme-tarot .app-container { background: var(--app-bg-tarot); } .theme-saju .app-container { background: var(--app-bg-saju); }
        #main-header { flex-shrink: 0; padding: 15px; display: flex; justify-content: space-between; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 50; transition: background 0.3s; }
        .action-btn { border-radius: 25px; padding: 12px; border: none; font-size: 1.1rem; font-family: 'Black Han Sans', sans-serif; cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: 0.1s; }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }
        @media (max-width: 768px) { .char-img { width: 140px; height: 140px; } .title-badge { font-size: 1.8rem; } .split-panel:hover { z-index: 10; clip-path: inherit; } .panel-left:hover { clip-path: polygon(0 0, 60% 0, 40% 100%, 0 100%); } .panel-right:hover { clip-path: polygon(60% 0, 100% 0, 100% 100%, 40% 100%); } }

        /* --- íƒ€ë¡œ ì¹´ë“œ UI --- */
        #tarot-card-table { display: flex; flex-wrap: wrap; justify-content: center; align-content: flex-start; gap: 4px; padding: 10px; perspective: 1000px; overflow-y: auto; flex: 1; width: 100%; }
        .tarot-card-face { width: 46px; height: 72px; background: radial-gradient(circle at center, #673ab7 0%, #311b92 100%); border: 1px solid #b39ddb; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.8rem; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s, background 0.2s; position: relative; overflow: hidden; }
        .deck-waite { background: radial-gradient(circle, #7e57c2 0%, #4527a0 100%); }
        .deck-belline { background: radial-gradient(circle, #1e88e5 0%, #0d47a1 100%); border-color: #90caf9; }
        .deck-lenormand { background: radial-gradient(circle, #8d6e63 0%, #4e342e 100%); border-color: #bcaaa4; }
        .tarot-card-face::after { content: 'ğŸ‹'; opacity: 0.8; font-size: 1.2rem; }
        
        /* ì¹´ë“œ ì„ íƒ íš¨ê³¼ */
        .card-selected { background: #fff !important; border-color: #ff6f00 !important; transform: translateY(-8px) scale(1.2) rotateY(180deg) !important; box-shadow: 0 10px 20px rgba(0,0,0,0.4) !important; z-index: 50; }
        .card-selected::after { content: ''; } 
        .card-selected::before { content: 'âœ¨'; font-size: 1.5rem; transform: rotateY(180deg); }

        /* ì…”í”Œ ì• ë‹ˆë©”ì´ì…˜ */
        #tarot-shuffle-view { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        .deck-stack { position: relative; width: 120px; height: 180px; }
        .deck-card { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #2e7d32; border: 4px solid #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; font-size: 3rem; }
        .deck-card::after { content: 'ğŸ‹'; }
        .shuffling .deck-card:nth-child(1) { animation: shuffleMove 0.5s infinite alternate; }
        .shuffling .deck-card:nth-child(2) { animation: shuffleMove 0.5s infinite alternate-reverse 0.1s; }
        .shuffling .deck-card:nth-child(3) { animation: shuffleMove 0.5s infinite alternate 0.2s; }
        @keyframes shuffleMove { 0% { transform: translateX(0) rotate(0); } 25% { transform: translateX(-20px) rotate(-5deg); } 75% { transform: translateX(20px) rotate(5deg); } 100% { transform: translateX(0) rotate(0); } }

        /* --- [NEW] 4-3-3 ê°€ì± (Gacha) ì—°ì¶œ ìŠ¤íƒ€ì¼ --- */
        #gacha-modal { position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .gacha-grid-433 {
            display: grid;
            grid-template-columns: repeat(12, 1fr); /* 12 ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ */
            gap: 10px;
            width: 95%; max-width: 400px;
            perspective: 1000px;
        }

        .reveal-card {
            aspect-ratio: 2/3;
            position: relative;
            transform-style: preserve-3d;
            opacity: 0;
            transform: scale(0.5) translateY(50px);
        }
        
        /* 4-3-3 ë°°ì¹˜ ë¡œì§ */
        /* ì²« ì¤„ 4ì¥: 3ì¹¸ì”© ì°¨ì§€ */
        .reveal-card:nth-child(1), .reveal-card:nth-child(2), .reveal-card:nth-child(3), .reveal-card:nth-child(4) { grid-column: span 3; }
        /* ë‘˜ì§¸ ì¤„ 3ì¥: 4ì¹¸ì”© ì°¨ì§€ */
        .reveal-card:nth-child(5), .reveal-card:nth-child(6), .reveal-card:nth-child(7) { grid-column: span 4; }
        /* ì…‹ì§¸ ì¤„ 3ì¥: 4ì¹¸ì”© ì°¨ì§€ */
        .reveal-card:nth-child(8), .reveal-card:nth-child(9), .reveal-card:nth-child(10) { grid-column: span 4; }

        .reveal-card.animate { animation: popAndFlip 0.8s forwards ease-out; }
        @keyframes popAndFlip {
            0% { opacity: 0; transform: scale(0.5) translateY(50px) rotateY(0deg); }
            50% { opacity: 1; transform: scale(1.1) translateY(0) rotateY(0deg); }
            100% { opacity: 1; transform: scale(1) translateY(0) rotateY(180deg); }
        }

        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .face.back { background: repeating-linear-gradient(45deg, #2c3e50, #2c3e50 5px, #34495e 5px, #34495e 10px); border: 2px solid #fff; }
        .face.front { background-color: white; color: #333; transform: rotateY(180deg); border: 2px solid #ffd700; overflow: hidden; padding: 2px; }

        /* Markdown Style */
        .markdown-body h1, .markdown-body h2 { color: #333; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .markdown-body strong { color: #d32f2f; }
        .markdown-body p { margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="app-container">

    <div id="gacha-modal" class="hidden">
        <h2 id="gacha-title" class="text-white text-2xl font-[Black Han Sans] mb-6 animate-pulse">ìš´ëª…ì˜ íë¦„ì„ ì½ëŠ” ì¤‘...</h2>
        
        <div class="gacha-grid-433 hidden" id="gacha-reveal-area-tarot"></div>
        
        <div id="gacha-reveal-area-saju" class="hidden flex flex-col items-center justify-center">
             <div class="relative w-40 h-40 animate-spin-slow">
                <div class="absolute inset-0 border-4 border-dashed border-red-500 rounded-full animate-spin"></div>
                <div class="absolute inset-2 border-4 border-yellow-400 rounded-full animate-ping"></div>
                <img src="./cat.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/616/616430.png'" class="absolute inset-0 w-full h-full object-cover rounded-full p-2">
             </div>
             <div id="saju-calc-msg" class="text-yellow-300 mt-8 text-xl font-bold animate-bounce">ë§Œì„¸ë ¥ ê³„ì‚° ì¤‘...</div>
        </div>

        <button id="gacha-finish-btn" class="action-btn bg-yellow-500 text-black font-bold mt-10 opacity-0 transition-opacity duration-500 px-8 shadow-xl hover:scale-105 transform">
            âœ¨ ê²°ê³¼ í™•ì¸í•˜ê¸°
        </button>
    </div>

    <div id="login-screen">
        <div class="version-tag">HG Agent v2.0 (Zero-Latency)</div>
        <div class="gemini-header">
            <div class="gemini-logo">HG AI Agent</div>
            <div class="gemini-greeting">
                <span id="greeting-msg">ì•ˆë…•í•˜ì„¸ìš”,</span>
                ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
            </div>
        </div>
        <div class="chat-input-area">
            <input type="password" id="login-api-key" class="chat-input" placeholder="Google Gemini API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="if(event.key==='Enter') attemptLogin()">
            <button onclick="attemptLogin()" class="chat-submit-btn">â¤</button>
        </div>
        <p class="text-xs text-gray-400 text-center pb-4">ì…ë ¥í•˜ì‹  í‚¤ëŠ” ì„¸ì…˜ ë™ì•ˆë§Œ ìœ ì§€ë©ë‹ˆë‹¤.</p>
    </div>

    <div id="selection-screen" class="hidden">
        <div class="split-panel panel-left" onclick="selectMode('tarot')">
            <img id="intro-panda-img" src="./panda.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3069/3069172.png'" class="char-img">
            <div class="title-badge">íƒ€ë¡œ íŒë‹¤</div>
        </div>
        <div class="split-panel panel-right" onclick="selectMode('saju')">
            <img id="intro-cat-img" src="./cat.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/616/616430.png'" class="char-img">
            <div class="title-badge">ë¬´ì† ëƒ¥ì´</div>
        </div>
    </div>

    <div id="main-app-ui" class="hidden h-full flex flex-col relative">
        <header id="main-header">
            <button onclick="goHome()" class="text-sm bg-white/20 px-3 py-1 rounded-full hover:bg-white/30 font-bold">â—€ ë’¤ë¡œ</button>
            <h1 id="header-title" class="font-bold text-lg font-[Do Hyeon]">ì„œë¹„ìŠ¤</h1>
            <div class="flex gap-2">
                <button onclick="openHistory()" class="text-sm bg-white/20 px-3 py-1 rounded-full" title="ê¸°ë¡ ë³´ê¸°">ğŸ“œ</button>
                <button onclick="checkAdmin()" class="text-white opacity-70 hover:opacity-100" title="ê´€ë¦¬ì ì„¤ì •">âš™ï¸</button>
            </div>
        </header>

        <div id="tarot-app" class="hidden flex-1 flex flex-col overflow-hidden relative">
            <div id="tarot-view-start" class="flex flex-col items-center justify-center text-center h-full p-4 overflow-y-auto">
                <img id="tarot-mascot" src="./panda.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3069/3069172.png'" class="w-28 h-28 rounded-full border-4 border-green-600 mb-4 bg-white object-cover shadow-lg">
                <h2 id="tarot-title" class="text-2xl font-bold text-green-900 mb-2 font-[Black Han Sans]">ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€?</h2>
                <p id="tarot-subtitle" class="text-green-700 mb-6 text-sm">ëŒ€ë‚˜ë¬´ ìˆ²ì˜ íŒë‹¤ê°€ ì¹´ë“œë¥¼ í¼ì¹©ë‹ˆë‹¤.</p>
                <input type="text" id="tarot-input" placeholder="ì˜ˆ: ì´ë²ˆ í”„ë¡œì íŠ¸ ì„±ê³µí• ê¹Œ?" class="w-full p-4 border-2 border-green-400 rounded-xl text-center mb-4 text-lg font-bold bg-white" onkeypress="if(event.key==='Enter') startTarotFlow()">
                <button class="action-btn bg-green-600 text-white w-full shadow-lg" onclick="startTarotFlow()">ìƒë‹´ ì‹œì‘</button>
            </div>

            <div id="tarot-shuffle-view" class="hidden h-full flex flex-col items-center justify-center">
                <div class="deck-stack shuffling mb-8">
                    <div class="deck-card"></div><div class="deck-card"></div><div class="deck-card"></div>
                </div>
                <h3 id="shuffle-text" class="text-2xl font-bold text-green-800 animate-pulse">ì¹´ë“œë¥¼ ì„ëŠ” ì¤‘...</h3>
            </div>

            <div id="tarot-view-game" class="hidden flex flex-col h-full overflow-hidden">
                <div class="bg-green-100 p-3 text-center shadow-sm z-10 flex-shrink-0">
                    <h3 id="tarot-stage-title" class="font-bold text-green-800 text-xl">ì¹´ë“œ ì„ íƒ</h3>
                    <p id="tarot-stage-desc" class="text-sm text-green-600">ì§ê´€ì ìœ¼ë¡œ ì¹´ë“œë¥¼ ê³ ë¥´ì„¸ìš”.</p>
                    <div id="tarot-selection-count" class="font-bold text-green-800 text-sm mt-1">0 / 0</div>
                </div>
                <div id="tarot-card-table"></div>
                <div class="p-3 bg-white border-t border-gray-200 z-10 flex-shrink-0">
                    <button id="tarot-next-btn" class="action-btn bg-green-600 text-white w-full hidden shadow-lg" onclick="confirmTarotSelection()">ë‹¤ìŒ ë‹¨ê³„</button>
                    <div id="tarot-guide-msg" class="text-center text-gray-400 text-xs font-bold py-3">ì¹´ë“œë¥¼ ëª¨ë‘ ì„ íƒí•˜ë©´ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <div id="saju-app" class="hidden flex-1 flex flex-col overflow-hidden p-4 overflow-y-auto">
            <div id="saju-view-start" class="flex flex-col items-center justify-center text-center h-full">
                <img id="saju-mascot" src="./cat.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/616/616430.png'" class="w-28 h-28 rounded-full border-4 border-red-400 mb-4 bg-white object-cover shadow-lg">
                <h2 id="saju-title" class="text-2xl font-bold text-red-900 mb-2 font-[Black Han Sans]">í•œë°©ì— í•´ê²°í•œë‹¤ëƒ¥!</h2>
                <p id="saju-subtitle" class="text-red-700 mb-6 text-sm">ìƒë…„ì›”ì¼ê³¼ ê³ ë¯¼ì„ í•œ ë²ˆì— ë§í•´ë³´ë¼ëƒ¥.</p>
                
                <div class="w-full bg-white p-5 rounded-xl border-2 border-red-200 space-y-3 shadow-lg">
                    <div class="flex gap-2">
                        <div class="flex-1"><label class="block text-xs font-bold text-left ml-1 mb-1 text-red-800">ğŸ“… ìƒë…„ì›”ì¼</label><input type="date" id="saju-date" class="w-full p-2 border border-red-200 rounded-lg text-center font-bold text-gray-700 bg-red-50" value="2000-01-01"></div>
                    </div>
                    <div class="flex gap-2">
                        <div class="flex-1"><label class="block text-xs font-bold text-left ml-1 mb-1 text-red-800">â° ì‹œê°„</label><input type="time" id="saju-time" class="w-full p-2 border border-red-200 rounded-lg text-center font-bold text-gray-700 bg-red-50" value="12:00"></div>
                        <div class="flex-1"><label class="block text-xs font-bold text-left ml-1 mb-1 text-red-800">âš§ ì„±ë³„</label><select id="saju-gender" class="w-full p-2 border border-red-200 rounded-lg text-center font-bold text-gray-700 bg-red-50"><option value="male">ë‚¨ì</option><option value="female">ì—¬ì</option></select></div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-left ml-1 mb-1 text-red-800">ğŸ¤” ê³ ë¯¼ ë‚´ìš©</label>
                        <input type="text" id="saju-input" placeholder="ì˜ˆ: ì¬ë¬¼ìš´ì´ ê¶ê¸ˆí•´!" class="w-full p-3 border-2 border-red-400 rounded-lg text-center font-bold bg-white" onkeypress="if(event.key==='Enter') startSajuFlow()">
                    </div>
                    <button class="action-btn bg-red-500 text-white w-full mt-2 shadow-lg hover:bg-red-600" onclick="startSajuFlow()">ğŸ”¥ ìš´ì„¸ í™•ì¸í•˜ê¸°</button>
                </div>
            </div>

            <div id="saju-view-result-check" class="hidden h-full flex flex-col items-center justify-center">
                 <div class="bg-white p-6 rounded-2xl border-2 border-red-800 text-center shadow-xl w-full">
                    <div class="text-sm bg-red-800 text-white inline-block px-4 py-1 rounded-full mb-4">ë‹¹ì‹ ì˜ íƒ€ê³ ë‚œ íŒ”ì</div>
                    <div id="saju-pillars-result" class="flex justify-center gap-3 mb-6"></div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-left">
                        <span class="text-2xl mr-2">ğŸ±</span>
                        <span id="saju-brief-msg" class="text-sm font-bold text-gray-700">ë¶„ì„ ë‚´ìš©...</span>
                    </div>
                 </div>
                 <button id="saju-final-btn" class="action-btn bg-red-600 text-white w-full mt-6 shadow-xl animate-bounce" onclick="showSajuFinalResult()">
                    ğŸ“œ AI ìƒì„¸ í’€ì´ ë°”ë¡œ ë³´ê¸°
                 </button>
                 <p class="text-xs text-gray-500 mt-2">ì´ë¯¸ ê³ ì–‘ì´ê°€ í•´ì„ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</p>
            </div>
        </div>

        <div id="common-view-result" class="hidden absolute inset-0 bg-white z-40 flex flex-col p-4 overflow-y-auto">
            <div class="text-right mb-4"><button onclick="resetCurrentMode()" class="text-sm text-gray-500 underline font-bold">ì²˜ìŒìœ¼ë¡œ</button></div>
            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-4"><span class="font-bold text-gray-600">Q.</span> <span id="result-question" class="font-bold">ì§ˆë¬¸</span></div>
            <div class="flex-1 bg-white border-2 border-dashed border-gray-300 rounded-xl p-5 relative overflow-y-auto shadow-sm">
                <button onclick="copyResult()" class="absolute top-2 right-2 text-xs bg-gray-100 px-2 py-1 rounded border">ë³µì‚¬</button>
                <div id="result-content" class="markdown-body text-sm leading-7 text-gray-800"></div>
            </div>
            <button class="action-btn bg-gray-800 text-white w-full mt-4" onclick="resetCurrentMode()">ë‹¤ë¥¸ ì§ˆë¬¸í•˜ê¸°</button>
        </div>

        <div id="common-view-history" class="hidden absolute inset-0 bg-white z-50 flex flex-col p-4">
            <h3 class="text-center font-bold text-xl mb-4 text-gray-800">ìƒë‹´ ê¸°ë¡</h3>
            <div id="history-list" class="flex-1 overflow-y-auto space-y-3 p-2"></div>
            <button class="w-full p-3 bg-gray-200 rounded-xl font-bold mt-4 text-gray-700" onclick="document.getElementById('common-view-history').classList.add('hidden')">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="admin-modal" class="hidden absolute inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl overflow-y-auto max-h-[90vh]">
            <h3 class="text-center font-bold text-xl mb-4 text-gray-800">ê´€ë¦¬ì ì„¤ì •</h3>
            <p id="admin-mode-label" class="text-sm text-center text-blue-600 font-bold mb-4">-</p>
            <div class="space-y-4">
                <div><label class="text-xs font-bold text-gray-500">ë©”ì¸ íƒ€ì´í‹€</label><input type="text" id="admin-title" class="w-full border p-2 rounded"></div>
                <div><label class="text-xs font-bold text-gray-500">ì„œë¸Œ íƒ€ì´í‹€</label><input type="text" id="admin-subtitle" class="w-full border p-2 rounded"></div>
                <div>
                    <label class="text-xs font-bold text-gray-500">ì•„ì´ì½˜ (ì´ë¯¸ì§€ ë³€ê²½)</label>
                    <input type="file" id="admin-file-input" accept="image/*" class="w-full text-xs mt-1" onchange="previewImage(this)">
                    <img id="admin-img-preview" class="w-16 h-16 rounded-full border mx-auto mt-2 bg-gray-100 object-cover">
                </div>
                <div class="p-3 bg-gray-100 rounded-lg border border-gray-200">
                    <label class="block text-xs font-bold text-gray-600 mb-2">AI ëª¨ë¸ ëª¨ë“œ</label>
                    <div class="flex flex-col gap-2">
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-200 p-1 rounded"><input type="radio" name="admin-model-mode" value="fast" class="w-4 h-4 text-blue-600" checked><span class="font-bold">âš¡ ë¹ ë¥¸ ì˜µì…˜ (Flash)</span></label>
                        <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-200 p-1 rounded"><input type="radio" name="admin-model-mode" value="best" class="w-4 h-4 text-blue-600"><span class="font-bold">ğŸ§  ìµœìƒ ì˜µì…˜ (Pro)</span></label>
                    </div>
                </div>
            </div>
            <button onclick="saveAdmin()" class="action-btn bg-blue-600 text-white w-full mt-4 text-sm">ì €ì¥ ë° ì ìš©</button>
            <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="w-full mt-2 text-sm text-gray-400">ë‹«ê¸°</button>
        </div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs, doc, setDoc, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const tarotConfig = { apiKey: "AIzaSyDuQDOi5wxabpqdqu-CJfdR-krk5Q08tBA", projectId: "test-9da10", appId: "1:578765851412:web:5d9d30e09f8427d1a49001" };
    const sajuConfig = { apiKey: "AIzaSyB-y3inMOTdj48gwlh0eftUc_YfyNTeJmc", projectId: "sajutest-e4eaa", appId: "1:753725539148:web:f2d67dd6b3adf6514345e9" };
    
    let dbTarot, dbSaju;
    try {
        const appTarot = initializeApp(tarotConfig, "tarotApp");
        dbTarot = getFirestore(appTarot);
        const appSaju = initializeApp(sajuConfig, "sajuApp");
        dbSaju = getFirestore(appSaju);
    } catch(e) { console.error("Firebase Init Error:", e); }

    let currentMode = null; 
    let gameState = { stage: 0, selections: { waite: [], belline: [], lenormand: [] }, question: "" };
    let sajuState = { pillars: [], colors: [], info: {}, question: "" };
    let uploadedImageBase64 = null; 
    let userApiKey = null; 
    let currentModelMode = 'fast'; 

    // â˜… Optimistic UIë¥¼ ìœ„í•œ Promise ë³€ìˆ˜ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì €ì¥ìš©) â˜…
    let tarotPredictionPromise = null;
    let sajuMansePromise = null;
    let sajuFinalPromise = null;

    // --- Login ---
    window.attemptLogin = () => {
        const key = document.getElementById('login-api-key').value.trim();
        if(!key) return alert("API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        userApiKey = key;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('selection-screen').classList.remove('hidden');
        if(dbTarot) loadConfig('tarot', true); if(dbSaju) loadConfig('saju', true);
    };

    // --- Selection ---
    window.selectMode = (mode) => {
        currentMode = mode;
        const mainUI = document.getElementById('main-app-ui');
        document.getElementById('selection-screen').classList.add('hidden');
        mainUI.classList.remove('hidden');
        document.body.className = ''; document.body.classList.add(`theme-${mode}`);
        document.getElementById('main-header').style.background = mode === 'tarot' ? '#2e7d32' : '#c62828';

        document.getElementById('tarot-app').classList.add('hidden');
        document.getElementById('saju-app').classList.add('hidden');
        document.getElementById(`${mode}-app`).classList.remove('hidden');
        
        showView(`${mode}-view-start`);
        loadConfig(mode);
    };

    window.goHome = () => {
        currentMode = null;
        document.getElementById('main-app-ui').classList.add('hidden');
        document.getElementById('selection-screen').classList.remove('hidden');
        document.getElementById('common-view-result').classList.add('hidden');
        document.getElementById('gacha-modal').classList.add('hidden');
        loadConfig('tarot', true); loadConfig('saju', true);
    };

    window.showView = (viewId) => {
        const container = document.getElementById(`${currentMode}-app`);
        const children = container.children;
        for(let c of children) c.classList.add('hidden');
        document.getElementById('common-view-result').classList.add('hidden');
        const target = document.getElementById(viewId);
        if(target) target.classList.remove('hidden');
    };

    window.resetCurrentMode = () => { 
        document.getElementById('gacha-modal').classList.add('hidden');
        showView(`${currentMode}-view-start`); 
    };

    // --- API Call ---
    async function callGemini(prompt, isJson = false) {
        if (!userApiKey) { alert("ì„¸ì…˜ ë§Œë£Œ."); location.reload(); return; }
        let modelName = 'gemini-2.0-flash-exp'; 
        if (currentModelMode === 'best') modelName = 'gemini-1.5-pro';

        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${userApiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }], generationConfig: isJson ? { responseMimeType: "application/json" } : {} };
            const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
            const data = await res.json();
            if(data.error) throw new Error(data.error.message);
            return data.candidates[0].content.parts[0].text;
        } catch (e) { console.error(e); throw e; }
    }

    // =========================================================================
    // [Tarot Logic] - 4-3-3 Layout & Zero Latency
    // =========================================================================
    
    // ì¹´ë“œ ì´ë¦„ ë§¤í•‘ (ê°„ì†Œí™”)
    function getCardName(deckKey, idx) {
        if(deckKey === 'waite') return idx < 22 ? `Major #${idx}` : `Minor #${idx-22}`;
        return `${deckKey} #${idx+1}`;
    }

    const TAROT_STAGES = [
        { key: 'waite', name: 'ìœ ë‹ˆë²„ì…œ ì›¨ì´íŠ¸', pick: 4, color: 'deck-waite', count: 78 },
        { key: 'belline', name: 'í˜¸ë¡œìŠ¤ì½”í”„ ë²¨ë¦°', pick: 3, color: 'deck-belline', count: 53 },
        { key: 'lenormand', name: 'ë ˆë…¸ë¨¼ë“œ', pick: 3, color: 'deck-lenormand', count: 36 }
    ];

    window.startTarotFlow = () => {
        const q = document.getElementById('tarot-input').value;
        if(!q.trim()) return alert("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”!");
        gameState.question = q;
        gameState.selections = { waite: [], belline: [], lenormand: [] };
        startTarotStage(0);
    };

    function startTarotStage(idx) {
        gameState.stage = idx;
        
        // â˜… ëª¨ë“  ì¹´ë“œ ì„ íƒ ì™„ë£Œ ì‹œ: AI í˜¸ì¶œê³¼ ì—°ì¶œ ë™ì‹œ ì‹œì‘ â˜…
        if(idx >= TAROT_STAGES.length) { 
            triggerTarotOptimisticProcess();
            return; 
        }
        
        const config = TAROT_STAGES[idx];
        showView('tarot-shuffle-view');
        document.getElementById('shuffle-text').innerText = `${config.name} ì„ëŠ” ì¤‘...`;
        
        setTimeout(() => {
            showView('tarot-view-game');
            setupCardTable(config);
        }, 1500); 
    }

    function setupCardTable(config) {
        document.getElementById('tarot-stage-title').innerText = config.name;
        document.getElementById('tarot-stage-desc').innerText = `${config.pick}ì¥ì„ ì„ íƒí•˜ì„¸ìš”.`;
        document.getElementById('tarot-next-btn').classList.add('hidden');
        document.getElementById('tarot-guide-msg').classList.remove('hidden');
        updateTarotCount(0, config.pick);

        const table = document.getElementById('tarot-card-table');
        table.innerHTML = "";
        
        // ëœë¤ ì¹´ë“œ ìƒì„± (ê°„ëµí™”)
        let indices = Array.from({length: 30}, (_, i) => i); 
        indices.forEach(idx => {
            const cardName = getCardName(config.key, idx);
            const card = document.createElement('div');
            card.className = `tarot-card-face ${config.color}`;
            card.dataset.name = cardName;
            card.onclick = () => toggleTarotCard(card, config.key, config.pick);
            table.appendChild(card);
        });
    }

    function toggleTarotCard(el, key, limit) {
        const list = gameState.selections[key];
        if(el.classList.contains('card-selected')) {
            el.classList.remove('card-selected');
            const idx = list.indexOf(el.dataset.name); 
            if(idx > -1) list.splice(idx, 1);
        } else {
            if(list.length >= limit) return alert(`${limit}ì¥ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥!`);
            el.classList.add('card-selected');
            list.push(el.dataset.name); 
        }
        updateTarotCount(list.length, limit);
        if(list.length === limit) {
            document.getElementById('tarot-next-btn').classList.remove('hidden');
            document.getElementById('tarot-guide-msg').classList.add('hidden');
        } else {
            document.getElementById('tarot-next-btn').classList.add('hidden');
            document.getElementById('tarot-guide-msg').classList.remove('hidden');
        }
    }
    
    function updateTarotCount(c, m) { document.getElementById('tarot-selection-count').innerText = `${c} / ${m}`; }
    window.confirmTarotSelection = () => startTarotStage(gameState.stage + 1);

    // [í•µì‹¬] ë°±ê·¸ë¼ìš´ë“œ AI ìš”ì²­ + í™”ë©´ ê°€ì±  ì—°ì¶œ
    window.triggerTarotOptimisticProcess = () => {
        // 1. Backend: AI ìš”ì²­ ì¦‰ì‹œ ì‹œì‘ (await í•˜ì§€ ì•Šê³  ë³€ìˆ˜ì— ì €ì¥)
        const prompt = `ì§ˆë¬¸:"${gameState.question}". ì¹´ë“œ:${JSON.stringify(gameState.selections)}. íƒ€ë¡œ ë¦¬ë”©í•´ì¤˜. í˜•ì‹: 1.ì¹´ë“œì˜ë¯¸ 2.í•´ì„ 3.ì¡°ì–¸ 4.ìš”ì•½. ë§íˆ¬: "~ë‹¤ íŒë‹¤"`;
        tarotPredictionPromise = callGemini(prompt).then(text => {
             if(dbTarot) addDoc(collection(dbTarot, "tarot_readings"), { question: gameState.question, response: text, timestamp: new Date() });
             return text;
        });

        // 2. Frontend: ê°€ì±  ì—°ì¶œ ì‹œì‘
        showTarotGachaReveal();
    }

    window.showTarotGachaReveal = () => {
        const modal = document.getElementById('gacha-modal');
        const grid = document.getElementById('gacha-reveal-area-tarot');
        const sajuArea = document.getElementById('gacha-reveal-area-saju');
        const btn = document.getElementById('gacha-finish-btn');
        const title = document.getElementById('gacha-title');
        
        // ì´ˆê¸°í™”
        grid.innerHTML = '';
        grid.className = 'gacha-grid-433'; // Grid ìŠ¤íƒ€ì¼ ì ìš©
        grid.classList.remove('hidden');
        sajuArea.classList.add('hidden');
        btn.style.opacity = '0';
        btn.onclick = finishTarotAndShow; // ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘ ì—°ê²°
        title.innerText = "ìš´ëª…ì˜ ì¹´ë“œ ë°°ì—´ (4-3-3)";
        modal.classList.remove('hidden');

        // ì¹´ë“œ ìˆ˜ì§‘ (ìˆœì„œëŒ€ë¡œ 4, 3, 3)
        const allCards = [
            ...gameState.selections.waite.map(n=>({n, t:'Waite'})),
            ...gameState.selections.belline.map(n=>({n, t:'Belline'})),
            ...gameState.selections.lenormand.map(n=>({n, t:'Lenormand'}))
        ];

        allCards.forEach((card, i) => {
            const cardWrap = document.createElement('div');
            cardWrap.className = 'reveal-card';
            cardWrap.innerHTML = `
                <div class="face back">?</div>
                <div class="face front">
                    <div style="font-size:20px; margin-bottom:2px;">ğŸ”®</div>
                    <div style="font-size:8px; font-weight:bold;">${card.t}</div>
                    <div style="font-size:10px; line-height:1.1;">${card.n}</div>
                </div>
            `;
            grid.appendChild(cardWrap);
            // ìˆœì°¨ ì• ë‹ˆë©”ì´ì…˜ (0.4ì´ˆ ê°„ê²©)
            setTimeout(() => cardWrap.classList.add('animate'), i * 400);
        });

        // ì• ë‹ˆë©”ì´ì…˜ì´ ì–¼ì¶” ëë‚  ë•Œ ì¯¤ ë²„íŠ¼ ë“±ì¥
        setTimeout(() => { btn.style.opacity = '1'; }, allCards.length * 400 + 500);
    }

    // ê²°ê³¼ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ (ë¡œë”© ì—†ì´ ì¦‰ì‹œ ëœ¸)
    window.finishTarotAndShow = async () => {
        const btn = document.getElementById('gacha-finish-btn');
        btn.innerText = "í•´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
        
        try {
            // ì´ë¯¸ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì™„ë£Œë˜ì—ˆì„ í™•ë¥  99%
            const text = await tarotPredictionPromise; 
            document.getElementById('gacha-modal').classList.add('hidden');
            displayResult(gameState.question, text);
        } catch(e) {
            alert("AI í˜¸ì¶œ ì‹¤íŒ¨: " + e.message);
            document.getElementById('gacha-modal').classList.add('hidden');
        }
    }

    // =========================================================================
    // [Saju Logic] - Integrated Flow & Zero Latency
    // =========================================================================
    
    window.startSajuFlow = async () => {
        const q = document.getElementById('saju-input').value;
        if(!q) return alert("ê³ ë¯¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        
        sajuState.question = q;
        sajuState.info = { 
            date: document.getElementById('saju-date').value, 
            time: document.getElementById('saju-time').value, 
            gender: document.getElementById('saju-gender').value 
        };

        // 1. Frontend: ê°€ì±  ì—°ì¶œ ì‹œì‘ (ì‚¬ì£¼ ë²„ì „)
        showSajuGachaReveal();

        // 2. Backend (Parallel): ë§Œì„¸ë ¥ ê³„ì‚° ì‹œì‘
        const mansePrompt = `ì—­í• :ë¬´ì†ì¸. ì •ë³´:${JSON.stringify(sajuState.info)}. JSONì¶œë ¥:{"pillars":["ì‹œ","ì¼","ì›”","ë…„"],"colors":["wood","fire","earth","metal","water"],"brief":"${q}ì— ëŒ€í•œ ì‚¬ì£¼ í•œì¤„í‰"}`;
        
        // ë§Œì„¸ë ¥ Promise ì €ì¥
        sajuMansePromise = callGemini(mansePrompt, true);
        
        // â˜… ì¤‘ìš”: ë§Œì„¸ë ¥ ê²°ê³¼ê°€ ì˜¤ë©´ -> ë°”ë¡œ ìµœì¢… í•´ì„ ìš”ì²­ì„ 'ì´ì–´ì„œ' ë³´ëƒ„ (ì²´ì´ë‹)
        // ì‚¬ìš©ìê°€ ë§Œì„¸ë ¥ì„ ë³´ê³  ìˆëŠ” ë™ì•ˆ ìµœì¢… í•´ì„ì´ ëŒì•„ê°.
        sajuFinalPromise = sajuMansePromise.then(jsonStr => {
            const data = JSON.parse(jsonStr);
            sajuState.pillars = data.pillars; // ë°ì´í„° ì €ì¥
            
            // ë§Œì„¸ë ¥ ê²°ê³¼ë¥¼ UIì— ë°˜ì˜ (í•˜ì§€ë§Œ í™”ë©´ì€ ì•„ì§ ê°€ì±  ì¤‘ì¼ ìˆ˜ ìˆìŒ)
            // ê°€ì±  í•¨ìˆ˜ì—ì„œ await sajuMansePromiseë¥¼ í•´ì„œ íƒ€ì´ë°ì„ ë§ì¶œ ê²ƒì„.

            // ì—¬ê¸°ì„œ ë°”ë¡œ ìµœì¢… í•´ì„ ìš”ì²­!
            const finalPrompt = `ì‚¬ì£¼íŒ”ì:${data.pillars.join(',')}. ì§ˆë¬¸:"${q}". ìœ„ ì‚¬ì£¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë¬´ì†ì¸ ê³ ì–‘ì´ ë§íˆ¬ë¡œ ìƒì„¸ ë‹µë³€í•´ì¤˜.`;
            
            const finalReq = callGemini(finalPrompt).then(text => {
                 if(dbSaju) addDoc(collection(dbSaju, "saju_history"), { question: q, answer: text, date: new Date().toISOString() });
                 return text;
            });
            return { manseData: data, finalReq: finalReq };
        });
    };

    async function showSajuGachaReveal() {
        const modal = document.getElementById('gacha-modal');
        const grid = document.getElementById('gacha-reveal-area-tarot');
        const sajuArea = document.getElementById('gacha-reveal-area-saju');
        const btn = document.getElementById('gacha-finish-btn');
        const title = document.getElementById('gacha-title');
        const msg = document.getElementById('saju-calc-msg');

        grid.classList.add('hidden');
        sajuArea.classList.remove('hidden');
        btn.style.opacity = '0';
        btn.onclick = null; // ì—¬ê¸°ì„  ë²„íŠ¼ ì•ˆì”€ (ìë™ ì „í™˜)
        title.innerText = "ì‚¬ì£¼ ëª…ì‹ì„ ë½‘ëŠ” ì¤‘ì´ë‹¤ëƒ¥!";
        msg.innerText = "ë§Œì„¸ë ¥ ê³„ì‚° ì¤‘...";
        modal.classList.remove('hidden');

        try {
            // 1. ë§Œì„¸ë ¥(1ì°¨)ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì—°ì¶œ ë³´ì—¬ì¤Œ (ìµœì†Œ 2ì´ˆ ìœ ì§€)
            await new Promise(r => setTimeout(r, 2000));
            const { manseData } = await sajuFinalPromise; // ë§Œì„¸ë ¥ ì™„ë£Œ ëŒ€ê¸°

            // 2. ë§Œì„¸ë ¥ ì™„ë£Œë˜ë©´ ëª¨ë‹¬ ë‹«ê³  'ì¤‘ê°„ ê²°ê³¼ í™”ë©´' ë³´ì—¬ì¤Œ
            modal.classList.add('hidden');
            
            // ì¤‘ê°„ ê²°ê³¼ UI ì—…ë°ì´íŠ¸
            const cont = document.getElementById('saju-pillars-result'); 
            cont.innerHTML = "";
            manseData.pillars.forEach((p, i) => { 
                cont.innerHTML += `<div class="w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-bold ${manseData.colors[i] || 'earth'}">${p}</div>`; 
            });
            document.getElementById('saju-brief-msg').innerText = manseData.brief;
            
            showView('saju-view-result-check'); // ì¤‘ê°„ í™”ë©´ ë…¸ì¶œ

        } catch (e) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
            modal.classList.add('hidden');
        }
    }

    // ìµœì¢… ê²°ê³¼ ë³´ê¸° ë²„íŠ¼ (ì´ë¯¸ ë¡œë”©ë˜ì–´ ìˆì„ ê²ƒì„)
    window.showSajuFinalResult = async () => {
        const btn = document.getElementById('saju-final-btn');
        btn.innerText = "ê³ ì–‘ì´ê°€ ë‹µë³€ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘...";
        
        try {
            const { finalReq } = await sajuFinalPromise;
            const text = await finalReq; // ì—¬ê¸°ì„œ ìµœì¢… í…ìŠ¤íŠ¸ ëŒ€ê¸° (ê±°ì˜ ì¦‰ì‹œ)
            displayResult(sajuState.question, text);
        } catch(e) { alert("AI ì˜¤ë¥˜"); }
    }

    // --- Common ---
    function displayResult(q, t) {
        document.getElementById('result-question').innerText = q;
        document.getElementById('result-content').innerHTML = marked.parse(t);
        document.getElementById('common-view-result').classList.remove('hidden');
    }
    window.copyResult = () => navigator.clipboard.writeText(document.getElementById('result-content').innerText).then(()=>alert("ë³µì‚¬ì™„ë£Œ"));

    // --- History & Admin (Previous Logic kept simple) ---
    window.openHistory = async () => {
        const listEl = document.getElementById('history-list');
        document.getElementById('common-view-history').classList.remove('hidden');
        listEl.innerHTML = "ë¡œë”© ì¤‘...";
        if(!dbTarot) return listEl.innerHTML = "DB ë¯¸ì—°ê²°";
        
        const db = currentMode === 'tarot' ? dbTarot : dbSaju;
        const col = currentMode === 'tarot' ? 'tarot_readings' : 'saju_history';
        const field = currentMode === 'tarot' ? 'timestamp' : 'date';

        try {
            const q = query(collection(db, col), orderBy(field, "desc"), limit(20));
            const snap = await getDocs(q);
            listEl.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                const div = document.createElement('div');
                div.className = "bg-gray-100 p-3 rounded flex justify-between items-center shadow-sm";
                div.innerHTML = `<div class="flex-1 truncate cursor-pointer" onclick="showDetail('${d.id}', '${col}')"><div class="font-bold text-sm text-gray-800">${data.question}</div></div>`;
                div.onclick = () => displayResult(data.question, data.response || data.answer);
                listEl.appendChild(div);
            });
        } catch(e) {}
    };

    // --- Admin Settings ---
    window.checkAdmin = () => { if(prompt("ê´€ë¦¬ì ì•”í˜¸")==="5690") document.getElementById('admin-modal').classList.remove('hidden'); };
    window.saveAdmin = async () => { alert("ì €ì¥ë¨(ë°ëª¨)"); document.getElementById('admin-modal').classList.add('hidden'); };
    async function loadConfig(m, h) { /* Config Loading Logic */ }

    // Dynamic Style for Saju Colors
    const style = document.createElement('style');
    style.innerHTML = `.wood{background:#2e7d32}.fire{background:#d32f2f}.earth{background:#fbc02d;color:#3e2723}.metal{background:#757575}.water{background:#212121}`;
    document.head.appendChild(style);

</script>
</body>
</html>
